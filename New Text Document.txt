ANSIBLE_MODULES_PATH=modules/ansible
ansible_modules=$(shell find $(ANSIBLE_MODULES_PATH) -not -path '*/\.*' -name playbook.yml -exec dirname {} \;)

# Ansible Lint Tasks
ansible-lint: ## Run ansible-lint for all playbooks
	@$(foreach module,$(ansible_modules), ansible-lint $(module)/playbook.yml; )

# Check Ansible Lint Tasks
ansible-lint-check: ## Check if Ansible playbooks follow best practices
	@$(foreach module,$(ansible_modules), ansible-lint --check $(module)/playbook.yml; )

# Ansible Formatting (using ansible-lint)
ansible-fmt: ## Format ansible files
	@$(foreach module,$(ansible_modules), ansible-lint --fix $(module)/playbook.yml; )

# Ansible Syntax Check
ansible-syntax-check: ## Check ansible syntax for all playbooks
	@$(foreach module,$(ansible_modules), ansible-playbook --syntax-check $(module)/playbook.yml; )

# Pre-commit hook tasks
precommit: ansible-lint ansible-fmt ## Run all linting and formatting before committing

# CI tasks for Ansible
ci: ansible-lint-check ansible-syntax-check ## Ensure all checks pass in CI
